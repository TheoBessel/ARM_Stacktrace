#############  Binutils  #############
.PHONY += readelf size

readelf:
	@$(READELF) -a $(TARGET) > $(TARGET:.elf=.readelf)
	@echo "[ =========================================================== ]"
	@echo "|                       Readelf saved !                       |"
	@echo "[ =========================================================== ]"

size:
	@$(SIZE) $(TARGET) > $(TARGET:.elf=.size)
	@echo "[ =========================================================== ]"
	@echo "|                        Size saved !                         |"
	@echo "[ =========================================================== ]"
######################################

###############  Debug  ##############
.PHONY += gdb debug

gdb: clean build readelf
	@echo "[ =========================================================== ]"
	@echo "|                       Starting QEMU ...                     |"
	@make debug &
	@echo "[ =========================================================== ]"
	@echo "|                       Starting GDB ...                      |"
	@echo "| ----------------------------------------------------------- |"
	@$(GDB) -q -x $(SCRIPT_DIR)/stacktrace.gdb $(TARGET)
	@echo "| ----------------------------------------------------------- |"
	@echo "|                        GDB exited !                         |"
	@echo "[ =========================================================== ]"

debug:
	@$(EMU) -S -s -machine mps2-an500 -cpu cortex-m7 -m 16M -kernel $(TARGET) -nographic -serial mon:stdio
######################################
